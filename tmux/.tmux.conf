# --- 기본 설정 ---
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*:Tc"

# 터미널 한글/UTF-8: 새 팬에서 로케일·IME 환경 변수 상속
set -g update-environment "LANG LC_ALL LC_CTYPE GTK_IM_MODULE QT_IM_MODULE XMODIFIERS"

set -g prefix C-a
unbind C-b
bind C-a send-prefix

set -g mouse on
setw -g mode-keys vi
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g status-interval 1

# 설정 다시 로드 (Ctrl+a r) — 실행 사용자 홈 기준 (dev 등 별도 사용자에서도 동작)
bind r source-file $HOME/.tmux.conf \; display "Reloaded $HOME/.tmux.conf"

# 직관적인 분할 키 (| 와 - 는 반드시 따옴표로 감싸야 tmux가 파이프로 오해하지 않음)
bind "|" split-window -h -c "#{pane_current_path}"
bind "-" split-window -v -c "#{pane_current_path}"
# 참고용: v/s 로도 분할 (ref)
bind v split-window -h -c "#{pane_current_path}"
bind s split-window -v -c "#{pane_current_path}"

# 팬 이동 (vi 스타일)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R
bind q display-panes

# 팬 크기 조절
bind ">" resize-pane -R 10
bind "<" resize-pane -L 10
bind "+" resize-pane -D 5
bind "_" resize-pane -U 5

# --- ★ 핵심: 중첩 Tmux 제어 (F12) ★ ---
# F12를 누르면 로컬 Tmux의 키 입력을 비활성화하여
# 안쪽(원격/도커) Tmux로 키를 전달합니다.
bind -T root F12  \
  set prefix None \;\
  set key-table off \;\
  set status-style "fg=colour245,bg=colour238" \;\
  if -F '#{pane_in_mode}' 'send-keys -X cancel' \;\
  refresh-client -S \;\

bind -T off F12 \
  set -u prefix \;\
  set -u key-table \;\
  set -u status-style \;\
  refresh-client -S

# --- 상태바: 동적 스크립트 (CPU, RAM, GPU, NPU) ---
# 실행 사용자 홈 기준 (dev 등 별도 사용자에서도 동작)
set -g status-position bottom
set -g status-style "bg=#1c1c1c,none"
set -g status-justify left
set -g status-left-length 100
set -g status-right-length 100
# 초기 표시 후 statusbar.tmux 가 덮어씀
set -g status-right "#[bg=colour228,fg=black]Loading...#[default]"
run-shell "$HOME/.tmux/statusbar.tmux 2>/dev/null"

# statusbar 스크립트가 없을 때를 위한 기본 상태바
setw -g window-status-current-format "#[fg=black,bg=green,bold] #I:#W #[default]"
setw -g window-status-format "#[fg=white,bg=#1c1c1c] #I:#W "
